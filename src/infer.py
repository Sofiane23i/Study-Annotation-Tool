import argparse

import torch
from path import Path

from dataloader import DataLoaderImgFile
from eval import evaluate
from net import WordDetectorNet
from visualization import visualize_and_plot

from PIL import Image
import PIL, sys
import numpy as np


from operator import itemgetter
import operator

from WordSegmentation import wordSegmentation, prepareImg








words=[

"-",
"-",
"-",
"-",
"-",
"-",
"-",
"-",
"-",
"-",
"-",
"-",
"-",
"-",
"-",
"trottine",
"petite",
"souris",
"une",
"plonge",
"forêt",
"la",
"touffue",
"rencontre",
"roux",
"a",
"des",
"yeux",
"-",
"an",
"-",
"Le",
"petitéléphant",
"rêve",
"de",
"voyager",
"Le",
"-",
"-",
"-",
"-",
"-",
"-",
"-",
"bruit",
"avant",
"le",
"soleil",
"se",
"léve",
"fleuve",
"Le",
"s'",
"appelle",
"Limpolo",
"ou",
"les",
"éléphant",
"n'",
"Du",
"temps",
"-",
"-",
"du",
"trompe",
"patin",
"récréation",
"charitable",
"patisson",
"manifice",
"capuchon",
"-",
"-",
"-",
"été",
"les",
"salade",
"verte",
"An",
"-",
"-",
"-",
"les",
"jardin.Le",
"jeune",
"-",
"le",
"blè",
"la",
"poule",
"picore",
"avec",
"noir",
"-",
"-",
"-",
"-",
"Il",
"fois",
"était",
"sorciére",
"une",
"une",
"chat",
"appellait",
"avais",
"qui",
"un",
"s",
"-",
"La",
"sorciére",
"dit",
"a",
"son",
"-",
"gôuter",
"vin",
"a",
"ma",
"soupe",
"oh",
"chat",
"carrottes",
"Le",
"ne",
"veux",
"la",
"gôuter",
"pas",
"a",
"soupe",
"aux",
"Alors",
"il",
"carrottes",
"déside",
"de",
"la",
"recherche",
"mettre",
"à",
"de",
"se",
"Alors",
"il",
"sort",
"deors",
"souris",
"chérche",
"La",
"chat",
"sorciére",
"sons",
"dans",
"toute",
"sa",
"maison",
"mes",
"chat",
"trouve",
"pas",
"sons",
"-",
"Il",
"êtes",
"foit",
"un",
"robot",
"qui",
"rencontre",
"un",
"une",
"chat",
"il",
"êtes",
"alargique",
"chat",
"il",
"courat",
"vite",
"mes",
"au",
"vite",
"vite",
"le",
"chat",
"êtes",
"pas",
"comme",
"les",
"autres",
"ses",
"poils",
"êtes",
"violet",
"clair",
"et",
"un",
"petitne",
"fontser",
"le",
"robot",
"cachat",
"derrier",
"arbres",
"le",
"chat",
"se",
"un",
"le",
"chécha",
"de",
"partout",
"dans",
"la",
"ville",
"il",
"mes",
"-",
"le",
"trouva",
"-",
"-",
"dit",
"mes",
"pourqoi",
"pas",
"ou",
"elle",
"est",
"très",
"facile",
"cachéte",
"elle",
"et",
"nul",
"ses",
"ma",
"souri",
"patin",
"récreation",
"charitable",
"patisson",
"capuchon",
"maniffique",
"les",
"salade",
"les",
"En",
"été",
"-",
"pousse",
"dans",
"jardin",
"les",
"le",
"blé",
"la",
"jeunne",
"caneton",
"poule",
"picor",
"avec",
"noir",
"de",
"voyager",
"-",
"soif",
"il",
"daventure",
"paseque",
"a",
"-",
"Limpolo",
"-",
"den",
"brose",
"les",
"-",
"il",
"se",
"-",
"tronpe",
"de",
"il",
"non",
"pa",
"-",
"patin",
"récréation",
"charitable",
"pation",
"manifique",
"-",
"capuchon",
"-",
"les",
"salades",
"les",
"jardins",
"En",
"été",
"vertes",
"-",
"-",
"le",
"Les",
"canetons",
"picore",
"-",
"-",
"avec",
"la",
"nior",
"Il",
"des",
"rêve",
"voyage",
"-",
"il",
"faire",
"voyage",
"-",
"ve",
"un",
"-",
"Il",
"limpolo",
"appelle",
"s",
"-",
"Il",
"brosse",
"à",
"dent",
"est",
"prend",
"se",
"sa",
"brosse",
"les",
"dent",
"-",
"-",
"Il",
"à",
"de",
"trompe",
"pas",
"-",
"petite",
"souris",
"une",
"trottine",
"forêt",
"la",
"touffue",
"rencontre",
"plonge",
"yeux",
"des",
"a",
"roux",
"-",
"-",
"a",
"-",
"-",
"-",
"-",
"tout",
"seul",
"De",
"-",
"voyager",
"-",
"l",
"enten",
"Pour",
"partinre",
"que",
"perssone",
"appelle",
"Limpolo",
"fleuve",
"s'",
"Le",
"-",
"l",
"Il",
"-",
"avent",
"se",
"les",
"dent",
"éléphant",
"Les",
"tous",
"petits",
"son",
"Patain",
"rècrèation",
"charitable",
"Patisson",
"capuchon",
"manifique",
"-",
"-",
"les",
"les",
"jardin",
"-",
"-",
"En",
"ètè",
"salade",
"pousse dans",
"verte",
"Le",
"canetons",
"picore",
"le",
"blès",
"la",
"poule",
"noir",
"jeunes",
"avec",
"-",
"-",
"-",
"-",
"-",
"-",
"voyager",
"-",
"le",
"Parce",
"voire",
"que",
"sa",
"mére",
"va",
"-",
"Limpolo",
"-",
"Il",
"brosse",
"énergiquement",
"se",
"-",
"les",
"éléphant",
"trompe",
"étais",
"sans",
"-",
"Patin",
"Récréation",
"Charitable",
"Patison",
"Capuchon",
"M",
"-",
"-",
"-",
"-",
"les",
"salade",
"dans les",
"-",
"En été",
"-",
"ardin",
"-",
"la",
"poule",
"Les",
"jeunes",
"caneton",
"picors",
"noir",
"avec",
"-",
"-",
"-",
"-",
"Le",
"chat",
"la",
"et",
"sorciére",
"Il",
"étais",
"fois",
"sorciérequi",
"une",
"une",
"chat",
"elle",
"lui",
"ditce",
"rencontra",
"un",
"Oui",
"être",
"ami",
"répont",
"tu",
"veux",
"mon",
"le",
"chat",
"Allon",
"maisons",
"voir",
"ma",
"-",
"-",
"-",
"dit",
"lechat",
"sorciére",
"-",
"dois",
"rentré",
"chez",
"je",
"-",
"le",
"chat",
"dit",
"Je",
"dois",
"dans",
"sa",
"cc",
"maison",
"se méfier",
"cette",
"sorciere",
"de",
"Il",
"était",
"fois",
"poilu",
"une",
"une",
"sociére",
"et",
"orrible",
"quand",
"elle",
"était",
"colére",
"elle",
"fouer",
"-",
"en",
"prener",
"un",
"et",
"taper",
"sontchatachaq",
"fois",
"-",
"-",
"le",
"taper",
"le",
"chat",
"-",
"enfuiller",
"s",
"font",
"de",
"la",
"forêt",
"et",
"la",
"au",
"sorcière",
"ria",
"d'",
"rire",
"tellmen",
"for",
"un",
"quon",
"lante",
"-",
"-",
"km",
"-",
"-",
"Un",
"jour",
"des",
"elle",
"un",
"chez",
"a",
"qu",
"sona",
"elle",
"q",
"la",
"premier",
"fois",
"Elle",
"la",
"pour",
"ouvra",
"porte",
"et",
"elle",
"tournicoton",
"de",
"cochon",
"je",
"vais",
"te",
"changer",
"et",
"que",
"mer",
"allors",
"le",
"le",
"en",
"-",
"monsieur",
"lui",
"dit",
"vous",
"-",
"vener",
"vouler",
"des",
"acheter",
"la",
"coquille",
"en",
"et",
"sorcière",
"ton",
"bas",
"amoureux",
"-",
"Le",
"L'éléphant",
"de",
"et",
"de",
"faire",
"avantur",
"rêve",
"une",
"il",
"veut",
"le",
"parce",
"que",
"pas",
"que",
"s'a",
"maman",
"remarque",
"-",
"Le",
"s'appelle",
"l",
"fleuve",
"impolo",
"Un",
"chat",
"est",
"il",
"des",
"-",
"a",
"gréfes",
"longues",
"est",
"grand",
"il",
"aime",
"et",
"jouer",
"joyeux",
"-",
"-",
"-",
"plus",
"il",
"aime",
"ballon",
"-",
"-",
"ouer",
"ais",
"-",
"chat",
"grifes",
"-",
"est",
"gentil",
"ne",
"il",
"saute",
"partout",
"est",
"pas",
"ne",
"pas",
"-",
"-",
"tranquile",
"et",
"calme",
"tout",
"seule",
"il",
"d",
"amis",
"il",
"a",
"pas",
"en",
"a",
"-",
"il",
"il",
"aime",
"que",
"un",
"a",
"4",
"ans",
"les",
"glace",
"la",
"fraises",
"a",
"au",
"chocolat",
"il",
"famille",
"a",
"une",
"bébé",
"deux",
"et",
"et",
"un",
"papa",
"une",
"-",
"-",
"-",
"-",
"-",
"-",
"-",
"-",
"-",
"-",
"-",
"-",
"Une",
"Souris",
"plonge",
"petit",
"forêt",
"yeux",
"la",
"-",
"des",
"rencontre",
"roux",
"trottine",
"a",
"touffue",
"Le",
"rêve",
"du",
"éléphant",
"de",
"petit",
"ses",
"voyager",
"mère",
"-",
"les",
"l",
"entan",
"pas",
"sa",
"Pour",
"-",
"que",
"Le",
"s'apelle",
"fleuve",
"limpolo",
"éléphant",
"brosse",
"les",
"dents",
"Le",
"petit",
"se",
"-",
"-",
"Les",
"éléphant",
"de",
"trompe",
"n'avai",
"pas",
"-",
"l",
"histoire",
"loup",
"Ses",
"d",
"chat",
"et",
"d",
"-",
"L",
"un",
"un",
"e",
"loup",
"habite",
"le",
"chat",
"dans",
"maison",
"et",
"une",
"dehort",
"chat",
"la",
"Le",
"voit",
"et",
"toc",
"toc",
"maman",
"-",
"le",
"loup",
"lu",
"Bonjour!",
"dit",
"ouvrant",
"porte",
"en",
"-",
"le",
"chat",
"B",
"onjour",
"dit",
"Je",
"entrer",
"peux",
"-",
"-",
"le",
"loup",
"boir",
"maison",
"Oui",
"dit",
"Tu",
"veut",
"un",
"-",
"fait",
"dehort",
"il",
"froid",
"tée",
"qui",
"-",
"parce",
"le",
"chat",
"chat",
"bien",
"dit",
"veut",
"-",
"je",
"e",
"-",
"le",
"loup",
"et",
"dit",
"dit",
"puisque",
"ses",
"pas",
"tu",
"tu",
"sort",
"-",
"aime",
"de",
"-",
"-",
"pas",
"ma",
"tu",
"n",
"te",
"aime",
"je",
"sort",
"de",
"le",
"ma",
"maison",
"lou",
"le",
"chat",
"-",
"dit",
"dit",
"aurevoir",
"en",
"petit",
"une",
"souris",
"trotine",
"la",
"yeux",
"ponge",
"des",
"rencontre",
"touffue",
"forêt",
"roux",
"a",
"de",
"parta",
"dans",
"l",
"l'aventure",
"soi",
"les",
"reiveille",
"autres",
"pour",
"ne",
"pas",
"-",
"il",
"impolo",
"appelle",
"-",
"-",
"il",
"les",
"dent",
"prossa",
"il",
"de",
"tompe",
"n'on",
"pas",
"Il",
"est",
"tes",
"fois",
"sorssiere",
"une",
"une",
"des",
"ingédien",
"qui",
"prenè",
"pour",
"lorce",
"sa",
"patsion",
"magice",
"au",
"maman",
"louplui",
"sauta",
"deux",
"la",
"sorsière",
"ou",
"un",
"plus",
"est",
"tes",
"rapide",
"le",
"l",
"a",
"que",
"oup",
"le",
"transforme",
"est",
"en",
"mouton",
"-",
"plonger",
"toufu",
"yeux",
"Une",
"la",
"trottiner",
"petite",
"-",
"souris",
"rencontrer",
"a",
"forêt",
"des",
"-",
"récréation",
"patin",
"-",
"charitable",
"capuchon",
"magnifice",
"-",
"-",
"-",
"-",
"En",
"été",
"les",
"salade",
"verte",
"dans",
"-",
"jardin",
"pousse",
"Les",
"caneton",
"le",
"blé",
"la",
"poule",
"noire",
"jeunes",
"picore",
"avec",
"trotine",
"Une",
"Petite",
"-",
"la",
"-",
"touffue",
"rencontre",
"des",
"-",
"a",
"roux",
"plonge",
"-",
"-",
"-",
"-",
"-",
"chat",
"dord",
"toute",
"la",
"journe",
"-",
"aprèt",
"-",
"dormid",
"il",
"-",
"allez",
"joue",
"a",
"va",
"avec",
"son",
"-",
"-",
"la",
"balle",
"le",
"bute",
"du",
"-",
"Il",
"-",
"joue",
"a",
"le",
"chat",
"-",
"-",
"est",
"atraper",
"-",
"jeux",
"que",
"arrive",
"a",
"la",
"balle",
"il",
"allez",
"apres",
"va",
"manger",
"est",
"il",
"doit",
"allez",
"coucher",
"le",
"lendement",
"ce",
"-",
"il",
"dormir",
"jusqu",
"-",
"9",
"h",
"3",
"va",
"a",
"0",
"-",
"-",
"-",
"-",
"-",
"-",
"-",
"des",
"Petite",
"rencontre",
"souris",
"la",
"plonge",
"a",
"Yeux",
"trottine",
"Forêt",
"roux",
"une",
"-",
"-",
"-",
"-",
"patin",
"récréation",
"charitable",
"patisson",
"manifique",
"capuchon",
"-",
"En",
"les",
"salades",
"verte",
"dans",
"les",
"jardin",
"été",
"pous",
"Les",
"le",
"blé",
"la",
"poul",
"jeune",
"caneton",
"avec",
"noir",
"picor",
"éléphant",
"Le",
"rêve",
"du",
"petit",
"de",
"voyager",
"ses",
"-",
"éléphant",
"il",
"Le",
"petit",
"-",
"parce",
"que",
"tout",
"seul",
"veux",
"voyager",
"-",
"fleuve",
"apelle",
"Le",
"impolo",
"s",
"-",
"éléphant",
"Le",
"petit",
"approcha",
"et",
"s",
"-",
"poche",
"et",
"dans",
"dans",
"prit",
"sa",
"main",
"sa",
"sa",
"a",
"-",
"les",
"éléphant",
"tu",
"histoire",
"debut",
"de",
"cette",
"avait",
"de",
"trompe",
"-",
"pas",
"-",
"trottine",
"souris",
"Une",
"roux",
"forêt",
"petite",
"rencontre",
"a",
"plonge",
"des",
"yeux",
"la",
"touffue",
"-",
"-",
"-",
"-",
"rèchèason",
"patrin",
"patison",
"charelitabele",
"manifiche",
"chopuchon",
"-",
"les",
"éte",
"saladevert",
"dans",
"Anan",
"pouse",
"lesjardin",
"pichore",
"le",
"bleles",
"-",
"-",
"avec",
"poule",
"noir",
"la",
"patin",
"récréation",
"charitable",
"patison",
"capuchon",
"manifique",
"-",
"-",
"En",
"les",
"salades",
"les",
"jardin",
"éte",
"-",
"Les,",
"jaune",
"caneton",
"le",
"blé",
"la",
"a poule",
"noire",
"picore",
"avec",
"petit",
"éléphant",
"est",
"qu'il",
"veut",
"Le",
"du",
"rêve",
"partir",
"en",
"voyage",
"Le",
"faire",
"de",
"petit",
"élépahnt",
"va",
"sans",
"-",
"-",
"-",
"aventure",
"il",
"bruit",
"parce",
"par",
"que",
"a",
"sappelle",
"limpolo",
"Le",
"fleuve",
"-",
"Quand",
"t-il",
"saproche",
"du",
"fleuve",
"les",
"il",
"lave",
"dents",
"ce",
"debut",
"l'histoire",
"les",
"éléphant",
"-",
"de",
"de",
"trompe",
"n",
"on",
"pas",
"Il",
"fois",
"chat",
"était",
"une",
"un",
"-",
"est",
"il",
"la",
"très",
"content",
"sortir",
"-",
"va",
"bébé",
"chat",
"dans",
"-",
"-",
"un",
"de",
"maman",
"Et",
"le",
"bébé",
"chat",
"-",
"est",
"sorti",
"la",
"le",
"ventre",
"de",
"-",
"sa",
"maman",
"-",
"bébé",
"chat",
"est",
"parti",
"avec",
"sa",
"maman",
"le",
"bébé",
"chat",
"tout",
"seul!",
"-",
"parti",
"la",
"de",
"chat",
"maman",
"-",
"-",
"le",
"bébé",
"chat",
"il",
"-",
"est",
"parti",
"-",
"la",
"seul",
"chat",
"chercha",
"tout",
"-",
"maman",
"il",
"le",
"bébé",
"-",
"est",
"trouver",
"chat",
"-",
"l",
"-",
"le",
"chat",
"-",
"devin",
"maman",
"Une",
"longe",
"yeux",
"forêt",
"la",
"rencontre",
"roux",
"-",
"petite",
"souris",
"a",
"trotine",
"toufu",
"des",
"-",
"-",
"-",
"-",
"petite",
"souris",
"trottine",
"une",
"rencontre",
"touffue",
"forêt",
"la",
"yeux",
"des",
"a",
"roux",
"plonge",
"le",
"cha",
"alor",
"elle",
"partir",
"A",
"le",
"chat",
"vit",
"devan",
"couru",
"balet",
"la",
"avec",
"mai",
"son",
"sorciere",
"Alor",
"transforma",
"elle",
"devai",
"atrapa",
"le",
"chat",
"la",
"et",
"dit",
"par",
"que",
"ou",
"chat",
"-",
"tu",
"petit",
"va",
"mon",
"comme",
"ça",
"alor",
"le",
"chat",
"miol",
"disent",
"miaou",
"en",
"-",
"la",
"le",
"miaou",
"miaou",
"-",
"sorciere",
"transfo",
"-",
"chat",
"-",
"en",
"-",
"-",
"Le",
"rêve",
"du",
"petit",
"élépant",
"est",
"de",
"partir",
"la",
"venture",
"a",
"Il",
"s'en",
"au",
"le",
"matin",
"va",
"très",
"-",
"pour que s",
"sa",
"ne",
"le",
"voit",
"pas",
"partir",
"Le",
"fleuve",
"s",
"'appelle",
"Limpolo",
"-",
"-",
"Il",
"doitseglisse",
"del'eau",
"Les",
"éléphant",
"été",
"sans",
"trompe",
"-",
"elle",
"-",
"ple",
"se",
"mes",
"a",
"-",
"-",
"-",
"-",
"pleu",
"-",
"a",
"-",
"-",
"terre",
"-",
"-",
"-",
"coup",
"Elle",
"la",
"-",
"porte",
"sourire",
"-",
"Elle",
"dit",
"-",
"-",
"cha",
"-",
"est",
"-",
"mon",
"-",
"chat",
"S",
"-",
"-",
"sote",
"dans",
"est",
"-",
"br",
"il",
"fut",
"est",
"-",
"eurreu",
"la",
"fin",
"des",
"dans",
"jusco",
"-",
"Partir",
"en",
"voyage",
"-",
"levoit",
"Pour",
"mére",
"pas",
"que",
"sa",
"-",
"Limpolo",
"-",
"brosse",
"les",
"il",
"dent",
"se",
"-",
"il",
"de",
"trompe",
"non",
"pas",
"-",
"patin",
"récréation",
"charitable",
"patisons",
"capuchon",
"magnifique",
"-",
"En",
"les",
"salades",
"poussentdent",
"jardin",
"été",
"verte",
"Les",
"le",
"blé",
"lapoulenoir",
"jeune",
"caneton",
"picores",
"avec",
"trottine",
"petite",
"souris",
"-",
"forêt",
"rencontre",
"plonge",
"yeux",
"roux",
"-",
"-",
"-",
"-",
"-",
"-",
"-",
"-",
"-",
"-",
"Yeux",
"Une",
"plonge",
"-",
"souris",
"trottine",
"Petite",
"rencontre",
"a",
"roux",
"touffue",
"souris",
"trottine",
"petite",
"une",
"forêt",
"la",
"touffue",
"des",
"a",
"récréation",
"patin",
"charitable",
"patisson",
"manifique",
"capuchon",
"dans",
"En",
"été",
"les",
"salades",
"-",
"les",
"jardin",
"-",
"poule",
"leblai",
"la",
"noir",
"Les",
"canton",
"jeune",
"picore",
"avec",
"Une",
"trotine",
"toffue",
"Yeux",
"la",
"plonge",
"petite",
"roux",
"forêt",
"des",
"rencontre",
"souris",
"a",
"récréation",
"patin",
"patison",
"charitable",
"capuchon",
"nagnifique",
"-",
"-",
"-",
"En",
"été",
"les",
"salades",
"verte",
"dans",
"pousse",
"les",
"-",
"-",
"le",
"jeunes",
"picore",
"blé",
"la",
"poule",
"noire",
"-",
"avec",
"-",
"-",
"-",
"-",
"Il",
"rêve",
"de",
"voyager",
"Ilpart",
"aventure",
"de",
"très",
"bonne",
"heure",
"en",
"Le",
"fleuve",
"limpolo",
"-",
"Il",
"lui",
"rien",
"Il",
"avait",
"n",
"de",
"trompe",
"pas",
"Il",
"était",
"était",
"trés",
"une",
"-",
"une",
"sorciere",
"qui",
"méchon",
"et",
"des",
"avai",
"pouvoir",
"-",
"elle",
"trénné",
"-",
"-",
"un",
"-",
"la",
"Alor",
"la",
"dans",
"-",
"transform",
"désside",
"de",
"-",
"sorciere",
"le",
"chat",
"chose",
"pabon",
"d",
"une",
"inpeu",
"-",
"la",
"desside",
"de",
"de",
"sorciere",
"le",
"transform",
"Alor",
"elle",
"desside",
"de",
"-",
"le",
"le",
"atendr",
"unpeu",
"soir",
"soir",
"la",
"oublier",
"arrive",
"sorciere",
"a",
"transforma",
"le",
"-",
"de",
"elle",
"tout",
"d",
"mai",
"un",
"-",
"vu",
"de",
"partire",
"voyage",
"an",
"il",
"partire",
"sangue",
"sa",
"le",
"maman",
"-",
"parsite",
"bochon",
"marech",
"il",
"a",
"petit",
"recreation",
"patin",
"patsont",
"charitable",
"capuchont",
"manifique",
"-",
"En",
"jardins",
"été",
"les",
"salades",
"vertes",
"dans",
"les",
"-",
"pousse",
"-",
"-",
"jeunes",
"le",
"blait",
"caneton",
"picore",
"avec",
"poule",
"noire",
"patin",
"récration",
"charitable",
"-",
"pticeor",
"capuchon",
"manifique",
"-",
"-",
"-",
"les",
"saladesvertes",
"dans",
"les",
"jardins",
"En",
"été",
"pouce",
"-",
"le",
"blé",
"avecla",
"poul",
"les",
"canotons",
"picore",
"noir",
"jeunes",
"-",
"-",
"-",
"-",
"-",
"ch",
"-",
"-",
"-",
"-",
"-",
"L",
"-",
"-",
"-",
"-",
"-",
"au",
"loup",
"-",
"-",
"-",
"-",
"-",
"-",
"-",
"-",
"-",
"-",
"-",
"-",
"-",
"dor",
"-",
"-",
"-",
"-",
"-",
"-",
"-",
"ses",
"-",
"-",
"-",
"-",
"-",
"-",
"dit",
"-",
"neige",
"-",
"-",
"-",
"-",
"-",
"-",
"-",
"-",
"-",
"-",
"-",
"-",
"-",
"-",
"-",
"-",
"petie",
"une",
"trottine",
"roux",
"la",
"rencontre",
"souris",
"yeux",
"forêt",
"plonge",
"a",
"-",
"touffue",
"des",
"rencontre",
"éléphant",
"de",
"-",
"rêve",
"du",
"petit",
"et",
"voyage",
"il",
"voyagé",
"parce",
"que",
"veux",
"feluves'appelle",
"limpolo",
"-",
"-",
"Il",
"brosse",
"la",
"-",
"dent",
"de",
"pri",
"sa",
"t",
"a",
"arrière",
"début",
"histoir",
"les",
"éléphant",
"Le",
"de",
"cette",
"c'est",
"qui",
"n",
"de",
"trompe",
"avai",
"pas",
"Patin",
"récréation",
"Potisson",
"charitable",
"Kapuchon",
"Manifique",
"été",
"les",
"En",
"salade",
"verte",
"pouss",
"dans",
"les",
"jardin",
"Les",
"jeune",
"-",
"le",
"-",
"poule",
"-",
"la",
"enoir"
]


def main():
    parser = argparse.ArgumentParser()
    parser.add_argument('--device', choices=['cpu', 'cuda'], default='cuda')
    args = parser.parse_args()

    net = WordDetectorNet()
    net.load_state_dict(torch.load('../model/weights', map_location=args.device))
    net.eval()
    net.to(args.device)

    loader = DataLoaderImgFile(Path('../data/testpng'), net.input_size, args.device)
    #loader = DataLoaderImgFile(Path('../data/bgsub'), net.input_size, args.device)
    res = evaluate(net, loader, max_aabbs=1000)
    nbr=0
    #image = Image.open('../data/testpng/bg00101.jpg')
    
    #print(image)
    

    
    fff = open("words.txt", "w")
    
    for i, (img, aabbs) in enumerate(zip(res.batch_imgs, res.batch_aabbs)):
    
        print(i)
        
        listoflist = []
        finallistoflist = [] 
        
        f = loader.get_scale_factor(i)
        aabbs = [aabb.scale(1 / f, 1 / f) for aabb in aabbs]
        
        img = loader.get_original_img(i)
        immg = loader.get_original_img_rgb(i)
        print(type(immg))        
        visualize_and_plot(img, aabbs)
        
        for ii in aabbs:
            listoflist.append([ii.xmin,ii.ymin,ii.xmax,ii.ymax])
            
        print(listoflist)
        listoflist2 = sorted(listoflist, key = lambda x: (x[1]))  
        print(listoflist2)
        print('------------------------')
        listoflist3 = sorted(listoflist, key = lambda x: (x[0]))  
        #print(listoflist3)
        
        
        listoflist22 = listoflist2
        
        #for iii in range(1, len(listoflist2)):
        #    print(iii)
        
        print()
        print('head of list: '+str(listoflist2[0]))
        print('head of list y coordinate: '+str(listoflist2[0][1]))
        print('head of list x coordinate: '+str(listoflist2[0][0]))
        
        xleft = listoflist2[0][0]
        
        #firstelt = listoflist2[0]
        #listoflist23 = listoflist2
        #listoflist23.pop(0)
        #print(firstelt)
        #print(listoflist23)
        
        print('---------- begining row extraction and bbox sorintg--------------------')
        print(len(listoflist2))
        
        finalrowsbbx = [] 
        #while listoflist2 not empty loop
        while len(listoflist2)>0:
        
            #already sort by y index
            topleftbbx = []
            downrightbbx = []
            xmin = listoflist2[0][0]
            xmax = xmin
            yxmin = listoflist2[0][1]
        
            print('xmin strat: '+ str(xmin))
            print('yxmin limit: '+ str(yxmin))

            #get the topleft bbx
            for jj in listoflist2:
                #print(jj[0])
                #print(xmin)
                #print(abs(jj[1]- yxmin))
                if(jj[0]<=xmin and abs(jj[1]- yxmin)<17):
                    topleftbbx = jj
                    xmin = jj[0]
                    ymin = jj[1]
                    print('-->'+str(xmin))
                
                
            #if(jj[0]>xmax):
                #downrightbbx = jj
                #xmin = jj[0]
                #ymin = jj[1]
                #print(downrightbbx)        

            print('topleftbbx: '+str(topleftbbx))
            #print('downrightbbx: '+str(downrightbbx))
        
            #get the first row bbx
            firstrowbbx = []
            firstrowbbx.append(topleftbbx)
            #listoflist2.remove(topleftbbx)
            for jj in listoflist2:
                if(jj[0] > topleftbbx[0] and abs(jj[1]-topleftbbx[1])<17):
                    firstrowbbx.append(jj)
                    #listoflist2.remove(jj)
            print(firstrowbbx)
            #print(listoflist2)
        
            #soting first row bbx
            firstrowbbx = sorted(firstrowbbx, key = lambda x: (x[0]))
             
            print(firstrowbbx)
        
            for ii in firstrowbbx:
                finalrowsbbx.append(ii)
                listoflist2.remove(ii)
        
        
        
        '''
        indexbbx = 0
        for jj in listoflist23:
            if(jj[0]<xleft):
                print('a bbox found'+str(indexbbx))
                break
            else:
                print('fine')
            indexbbx = indexbbx + 1
            
        finallistoflist.insert(0, firstelt)
        print(finallistoflist)  
        '''      
        
        for ii in finalrowsbbx:
            #print (ii[0])
            #print (ii.ymin)
            #print (ii.xmax)
            #print (ii.ymax)
            #print ()
            
            
            
            box = (ii[0], ii[1], ii[2], ii[3])
            crop = immg.crop(box)
            #cropped= img[ii[0]:ii[1], ii[2]:ii[3]]
            #img = img(img, np.uint8)
            #print(img.shape)
            #print(immg)
            #img = (immg).astype(np.uint8)
            
            #import matplotlib.pyplot as plt
            #plt.imshow(img)
            #plt.show()
            #print(img)
            #imgg = Image.fromarray(img, 'RGB')
            
            #if imgg.mode != 'RGB':
            #    imgg = imgg.convert('RGB')
            #crop = imgg.crop(box)
            #if crop.mode != 'RGB':
            #    crop = crop.convert('RGB')
            
            crop.save('out/%s.png'%(nbr), 'png')
            if(words[nbr] != '-'):
                fff.write(str(nbr)+' ok X '+ str(round(ii[0]))+' '+str(round(ii[1]))+' '+str(round(ii[2]))+' '+str(round(ii[3]))+' X '+words[nbr]+'\n')
            nbr=nbr+1
        print(len(listoflist2))
        #print(listoflist)
        #listoflist2 = sorted(listoflist, key = operator.itemgetter(0, 1))  
        #print(listoflist2)  
    fff.close()


if __name__ == '__main__':
    main()
